# Stage 4 - 여러 페이지에서 수집해보자

지금까지 한 페이지짜리 네이버 TV TOP100을 수집해보고, 네이버 뉴스도 검색된 첫 번째 페이지의 기사만 수집해보았습니다.

이제 페이지를 벗어나 여러 페이지에 걸쳐 데이터를 수집해볼 것입니다. 실제로 데이터 수집을 하다보면 수집할 데이터가 한 페이지에 모여있는 경우는 많지 않습니다.

먼저 페이지의 주소를 파헤쳐 여러 페이지를 쉽게 수집할 힌트를 찾아보겠습니다.

## 네이버시 뉴스구 아시안게임동...

![](../.gitbook/assets/image%20%28306%29.png)

이것은 네이버 뉴스에 "아시안게임" 이라는 키워드로 검색했을 때의 페이지 주소입니다. 약간 다를 수도 있지만, 다음에 나오는 요소들은 모두 포함하고 있을 것입니다.

![](../.gitbook/assets/image%20%2889%29.png)

주소를 잘 찾아보면 물음표가 딱 하나 있을 것입니다.

이 물음표를 기준으로 앞부분은 네이버 검색 페이지의 주소입니다. 네이버 검색을 사용하면 통합검색이든, 이미지 검색이든, 어떤 키워드를 검색하든 이 주소는 변하지 않습니다.

![](../.gitbook/assets/image%20%28437%29.png)

뒷부분은 요청값을 전달하는 부분입니다. 쿼리스트링, 쿼리문자열이라고 합니다. 이 값을 좀 더 뜯어보겠습니다.

![](../.gitbook/assets/image%20%28170%29.png)

잘 보면 어떤 규칙이 보이실 겁니다. 마치 변수에 값을 넣듯 a=b의 형태로 이루어져있고 각 요소들은 &로 이어져 있습니다.

![](../.gitbook/assets/image%20%28395%29.png)

영단어 뜻으로 추측하거나 검색 조건을 이리저리 바꾸면서 테스트 해봤을 때, 각 값은 다음과 같은 의미를 갖는 것 같습니다.

sm은 뭔지 잘 모르겠습니다. 심지어 없애버려도 결과가 달라지지 않습니다.

where는 검색 탭을 의미합니다. 이미지로 바꾸면 image, 실시간검색은 realtime 등으로 값이 바뀌는 것을 볼 수 있습니다.

query는 검색어입니다. 초록창에 검색어를 입력하지 않고도 이 부분을 바꿔 접속보면 해당 키워드로 검색되는 것을 볼 수 있습니다.

이처럼 웹페이지의 주소는 기존에 여러분이 알던 것 이상으로 많은 정보를 내포하고 있습니다.

## 페이지를 이동해보자

이제 뉴스 검색 결과에서 페이지를 이동하며 주소의 변화를 지켜봅시다.

페이지를 이동하면 주소의 요청값에 엄청나게 많은 값들이 붙는 것을 볼 수 있습니다.

하지만 대부분은 지금 필요한 것이 아니고, 하나만 확인하면 됩니다.

![](../.gitbook/assets/image%20%28240%29.png)

페이지를 옮길 때마다 start의 값이 변합니다. 그리고 일정한 규칙을 찾을 수 있는데 \(페이지 - 1\) \* 10 + 1의 값을 갖습니다.

이는 단어의 의미와 가진 정보로 추측해보건대 현재 페이지가 가지고 있는 기사가 전체 기사의 31번째에서 시작한다는 의미일 것입니다.

{% hint style="info" %}
이번 스테이지 들어 부쩍 문장을 추측형으로 끝내고 있다는 걸 눈치채셨나요?

사실 웹 데이터 수집은 규칙을 추측하는 싸움이라고 말할 수 있습니다.

실제 개발자가 아닌 이상 이 규칙이 이것을 의미한다고 100% 확신할 수 없고, 대신 최대한 추측하여 수집에 역이용하는 것이죠.
{% endhint %}

그래서 이 값을 바꾸면서 접속해보면, 실제로 페이지에 나타나는 기사의 목록이 바뀝니다.

이제 발견한 규칙을 이용해 파이썬 상에서 여러 페이지에 연속적으로 접근해 보겠습니다.

## 페이지를 이동하며 수집해보자

이제 주소 요청값 중 start를 바꾸어가며 여러 페이지의 기사를 수집해보겠습니다. 가볍게 3페이지까지만 수집합니다.

```python
for page in range(3):
    raw = requests.get('https://search.naver.com/search.naver?&where=news&query=아시안게임&start=' + str(page * 10 + 1), headers={'User-Agent': 'Mozilla/5.0'}).text
    html = BeautifulSoup(raw, 'html.parser')
    articles = html.select('.type01 > li')

    for article in articles:
        journal = article.select_one('span._sp_each_source').text
        title = article.select_one('a._sp_each_title').text

        print(journal, title)
```

방법은 크게 다르지 않습니다.

한 페이지를 수집하는 코드를 그대로 for문 안에 집어넣고, 반복 변수를 이용해 start만 원하는대로 바꾸어주면 됩니다.

그런데 처음 사용하는 문법이 몇 가지 있습니다. 간단히 설명드리겠습니다.

### 타입을 바꿔주는 타입 캐스팅

```python
num = 100
print(num * 3)

num = str(num)
print(num * 3)

num = int(num)
print(num * 3)
```

![&#xCD9C;&#xB825; &#xACB0;&#xACFC;](../.gitbook/assets/image%20%2823%29.png)

주소의 쿼리 스트링에 start 값을 변화시키기 위해 변수를 추가해야 하는데, 문자열과 숫자는 서로 더할 수 없습니다. 내장함수 str\(\) 은 숫자를 문자열 타입으로 바꾸어 줍니다. 11이 '11'로 변하는 것이죠. 이제 이 문자열 타입의 숫자는 문자열 타입의 주소와 더해져 완전한 주소가 됩니다.

반대로 내장함수 int\(\) 는 문자열 타입의 숫자를 숫자 타입으로 바꾸어 줍니다.

### 숫자 리스트를 생성해주는 range

같은 명령을 다른 조건에서 반복하여 내리려면 일단 for 문이 생각납니다.

그런데 페이지를 1부터 3까지 바꾸면서 반복시킨다는 것을 어떻게 명령할까요?

프로그래밍을 하다보면 이러한 필요성이 굉장히 많기 때문에 파이썬의 기본 내장 함수 range가 존재합니다.

```python
for i in range(10):
    print(i)

for i in range(5, 15):
    print(i)

for i in range(100, 110, 2):
    print(i)
```

range 함수는 일정하게 증가하는 등차수열을 만들어 줍니다.

입력값은 하나, 두개, 세개를 받는 경우의 동작 방식이 각각 다릅니다.

입력값을 하나만 쓸 경우 0부터 \(입력값 - 1\) 까지 1씩 증가하는 숫자 리스트를 만듭니다.

입력값을 두 개 쓸 경우 첫 번째 입력값부터 \(두 번째 입력값 - 1\) 까지 1씩 증가하는 숫자 리스트를 만듭니다.

입력값을 세 개 쓸 경우 첫 번째 입력값부터 \(두 번째 입력값 - 1\) 까지 세 번째 입력값씩 증가하며 반복하는 리스트를 만듭니다.

```python
for page in range(3):
    raw = requests.get('https://search.naver.com/search.naver?&where=news&query=아시안게임&start=' + str(i * 10 + 1), headers={'User-Agent': 'Mozilla/5.0'}).text
    # 생략
```

그래서 위와 같은 코드를 작성하면 for문은 \[0, 1, 2\] 의 숫자 리스트를 반복하게 되고, 쿼리 스트링 start에 들어가는 각각 '1', '11', '21' 이 되어 원하는 페이지로 접근할 수가 있습니다.

str\(\) 함수를 사용해 숫자를 문자열로 바꿔주지 않으면 문자열 + 숫자 덧셈 에러가 발생하니 꼭 잊지 마세요!

### 중첩 반복문

```python
for i in range(3):
    페이지마다 할 일들...

    for article in articles:
        페이지 내의 기사마다 할 일들...

        print('페이지', i, '완료')
    print('전체 완료')
```

일반 실행 공간과 분리되는 for 문의 실행 공간에 대해 설명드린 적이 있습니다.

지금 예제는 반복문 안에 또 다른 반복문이 작성된 구조입니다.

따라서 페이지 내에서 기사를 반복하여 처리하는 코드들은 두 번 들여쓰기가 되어 있는 상태입니다.

실행 공간 역시 두 번 분리되어 있습니다. 기사 반복 변수 article은 페이지 반복 공간 내에서는 사용이 불가능합니다.

페이지는 3개이고 각각 기사를 5개씩 가지고 있다면 이 코드의 흐름은 어떻게 반복 될까요?

이해를 돕기 위해 적절한 위치에 페이지 완료 메세지, 전체 완료 메세지를 작성하려고 합니다.

### 깜짝 실습!

완료 메시지가 제 위치에 출력되지 않습니다. 실행공간 간의 관계를 생각하여 올바른 위치로 변경해주세요.

정답은...

```python
for i in range(3):
    페이지마다 할 일들...

    for article in articles:
        페이지 내의 기사마다 할 일들...

    print('페이지', i, '완료')
print('전체 완료')
```

입니다 :\)

