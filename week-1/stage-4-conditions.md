# Stage 4 - 완벽한 선택자 경로를 만들자

스테이지 4에서는 실제 사용되는 선택자 경로의 조건에 대해 알아봅니다.

스테이지 3에서 선택자 경로를 찾는 방법을 간단히 알아보았지만 선택자의 성질에 따른 정확한 규칙을 지키지 않으면 의도치 않은 결과가 나오기 쉽습니다.

상황에 맞게 항상 고려해야하는 선택자 경로의 세가지 조건에 대해 배우겠습니다.

## 1. 간결성

선택자 경로는 간결한 것이 좋습니다. 전체 내용을 감싸는 태그부터 출발하는 기나긴 경로를 사용한다고해서 나아지는 점은 하나도 없으니까요. 오히려 선택자를 하나하나 찾아가는 데에 걸리는 시간이 낭비됩니다.

![](../.gitbook/assets/image%20%28280%29.png)

스테이지 3에서 찾았던 클립 정보 하나의 선택자 경로는 위와 같습니다. 하지만 꼭 처음부터 시작하여 정직하게 삽질을 해야 할까요? 

앞서 말씀드렸듯 데이터 수집기의 강력한 능력은 'div.cds' 만 명령해도 전체 문서 안에서 cds 클래스를 가진 모든 div 태그를 눈 깜짝할 새에 불러옵니다.

결국 선택자 경로 상에서 가장 중요한 선택자는 우리가 원하는 데이터가 있는 마지막 선택자입니다. 일단 그 앞에 있는 것들은 다 지워봅시다.

![](../.gitbook/assets/image%20%28324%29.png)

## 2. 정확성

짧은 선택자 경로는 좋지만, 생략은 필연적으로 불확실성을 야기합니다.

![](../.gitbook/assets/image%20%28107%29.png)

위와 같은 네이버 TV 정보 중에서 각 클립의 조회 수에 도착할 수 있는 경로를 찾아냈습니다. 그리고 간결성을 위해 과감히 앞에 있는 모든 경로를 지웠습니다. 이제 이 선택자를 사용해 수집 명령을 내리면, 100개 클립의 조회수가 깔끔하게 들어올까요?

모를 일입니다. 옆에 있는 조회수도 똑같이 span.hit이면요? 두 데이터가 표현되는 모양이나 의미가 상당히 비슷하고, 클래스는 고유성이 없기 때문에 충분히 가능합니다.

이렇게 선택자를 하나 정하고 나면 이것이 정확히 내가 원하는 데이터만을 가져올 지 검증을 해야 합니다.

![](../.gitbook/assets/image%20%28104%29.png)

개발자 도구에서 Ctrl + F를 눌러 검색창을 엽니다. 여기에 선택자인 span.hit을 적어 검색해봅니다.

오른쪽을 보니 검색된 개수가 100개라고 하네요. 예상한 숫자와 딱 맞습니다. 엔터 버튼 \(다음 검색\)을 쭉 눌러보며 이중으로 검증을 마칩니다.

클립 조회수 이외에 span.hit이 쓰인 곳은 없네요. 비로소 안심하고 선택자를 사용할 수 있게 되었습니다.



### 세분화

경로라고 하니 네비게이션이 생각나는데, 광주를 검색한 후 눈을 감고 목적지를 찍으면 경기도 광주로 가게 될까요? 전라도 광주로 가게 될까요?

역시 가장 중요한 것은 "광주"라는 최종 목적지이지만, 앞에서 경기도, 전라도 등으로 적절히 범위를 한정해주면 훨씬 정확한 결과를 얻을 수 있습니다.



![](../.gitbook/assets/image%20%2816%29.png)

앞에서 개발자 도구를 사용하며 네이버 TV TOP 100의 클립들이 1~3위와 4~100위 두 부분으로 나뉜다는 것을 보셨죠?

이중 1~3위의 조회수만 가져오고 싶다면 어떨까요? 조회수의 선택자는 모두 span.hit입니다.

![](../.gitbook/assets/image%20%2870%29.png)

이렇게 같은 선택자의 데이터 중에서 범위를 좁히고 싶다면 1~3위 조회수와 4~100위 조회수가 다른 조상을 갖는다는 사실을 이용해야 합니다.

![](../.gitbook/assets/image%20%28336%29.png)

두 데이터는 공통 조상 div.top100으로부터 div.top\_main과 div\#content에서 처음 갈라져 많은 구분되는 조상들을 가지고 있지만 간결하게 구분될 만큼만 이용해주면 됩니다.

바로 위의 부모를 볼까요?

![](../.gitbook/assets/image%20%28318%29.png)

1~3위는 span.meta &gt; span.hit이고 4~100위는 dd.meta &gt; span.hit 입니다. 하나의 조상만 이용해도 두 데이터를 구분하여 수집할 수 있죠.



### 일반화

지금까지 의도치 않은 데이터를 더 가져올까봐 검증하는 경우였다면, 의도한 데이터를 다 못 가져올까봐 검증해야하는 경우도 있습니다.

![](../.gitbook/assets/image%20%2857%29.png)

도전과제 1에서 다룬 해커뉴스의 기사들입니다. 이 페이지에서 기사의 제목들만 뽑아내려고 하는 상황입니다.

![](../.gitbook/assets/image%20%28317%29.png)

기사 제목이 있는 태그는 ID와 클래스를 모두 가지고 있는데 어떤 선택자를 사용하는 게 좋을까요?

모양이 비슷해 놓치셨을수도 있겠지만 여기 보이는 모든 기사 태그들의 ID는 다릅니다. ID는 하나뿐인 고유한 값이니까요.

![](../.gitbook/assets/image%20%2848%29.png)

그러니 둘 중 ID를 사용했다면 기사는 처음의 하나밖에 가져올 수 없습니다.

이렇게 어느 한 HTML 요소의 선택자를 찾고 비슷한 요소로 일반화시켜 리스트를 불러올 때에는 선택자가 리스트의 모든 요소를 커버하는지를 검증해야 합니다. 지금처럼 클래스와 ID간의 선택이라면 쉽게 발견할 수 있겠지만 종종 좁은 범위의 클래스와 넓은 범위의 클래스 두 가지를 가지고 있는 경우도 있습니다.



![](../.gitbook/assets/image%20%28166%29.png)

이렇게 클래스와 ID는 서로 반대되는 특성을 갖기 때문에 상황에 맞게 꺼내쓸 수 있도록 숙달시켜야 합니다.



## 3. 응집성

클립 데이터 수집 시나리오를 다시 살펴봅시다.

![](../.gitbook/assets/image%20%28312%29.png)

우리는 먼저 4위 ~ 100위 클립에서 제목, 채널명, 조회수, 좋아요 수를 모두 뽑아낼 것입니다.

제가 찾은 각각의 선택자 경로는 다음과 같습니다.

![](../.gitbook/assets/image%20%28249%29.png)

이 네 개의 선택자 경로를 이용하면 원하는 단위 데이터를 모두 뽑아낼 수 있습니다.



![](../.gitbook/assets/image%20%28160%29.png)

4개의 선택자를 사용한 결과 4개의 데이터 리스트를 성공적으로 얻어낼 수 있겠습니다.

하지만 데이터는 뽑아낸다고 끝이 아닙니다. 가치있게 활용될 수 있도록 많은 가공을 거쳐야 합니다.



![](../.gitbook/assets/image%20%2892%29.png)

그런데 생각을 해보세요. 대부분의 상황에서 TOP 100 정보의 최소 단위는 '클립'입니다. 한 클립의 제목, 채널명, 조회수, 좋아요가 함께 응집되어 있어야 의미를 갖기 시작합니다. 그렇지 못한 채 흩뿌려져있는 값들은 텍스트 쪼가리일 뿐입니다.

그렇기 때문에 같은 클립의 정보들은 대개 함께 처리되어야 합니다. 자세한 가공 과정은 3주차 실제 수집 시에 겪어보겠지만, 선택자 경로 레벨에서 같은 클립 데이터끼리의 응집성을 만들어 놓을 필요가 있습니다.



![](../.gitbook/assets/image%20%28230%29.png)

다시 말하면 목록을 형성하는 것은 최소 의미 단위인 편이 좋습니다.

제목 목록, 채널명 목록, 조회수 목록, 좋아요 수 목록이 아니라 하나의 '클립 목록'에서 각 클립의 네 종류 정보를 사용해야 한다는 것입니다.

따라서 처음으로 가져와야할 데이터는 클립 정보 전체를 담고 있는 div.cds 입니다.

최소 의미 단위에 딸린 세부 정보들은 div.cds의 하위 선택자 경로로 찾아가면 됩니다.

따라서 응집성을 고려해 다시 선정한 선택자 경로는 다음과 같습니다.

![](../.gitbook/assets/image%20%28223%29.png)

조회수와 좋아요 수에 붙어있던 dd.meta는 더 이상 필요가 없습니다. 1~3위 클립의 조회수, 좋아요 수와 구분하기 위해 붙인 것인데 어차피 div.cds 목록엔 4위 ~ 100위까지의 클립 정보만 포함되기 때문입니다.

